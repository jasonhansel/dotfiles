#!/bin/bash

# https://gist.github.com/bailsman/0be72ceba495f4e3fab6

set -o errexit
set -o nounset
set -euo pipefail

# exec 2>&1 &> >(tee -a $HOME/test.txt)

if [[ "$*" = "Enter passphrase for key"* || "$*" = "Username for"* || "$*" = "Password for"* || "$*" = *"password"*  ]]
then
 { echo "SETTITLE saving" ;
  echo "SETDESC $*" ;
  echo "GETPIN" ; } | PINENTRY="pinentry-qt" pinentry-kwallet | sed -n 's/^D //p' | head -c-1
else  
  { echo "SETTITLE unsaved" ;
  echo "SETDESC $*" ;
  echo "GETPIN" ; } | pinentry-qt | sed -n 's/^D //p' | head -c-1
fi
